
<!doctype html>
<html>

  <head>
    <meta charset="utf-8">
  </head>

  <body>
    
    <script type="module">

      // Mandlebrot set rendering 
      // 
      // 
      
      import { Plotter } from '/js/plotter.js';
      import { Complex, MutableComplex } from '/js/complex.js';
      import { Mandlebrot } from '/js/mandlebrot.js';


      const points = 500;
      var xp = 0;
    

      function process_grid(frameCount) {

        // x values in xp , xp + 10 
        // all possible y values 
        // 
        let pixels = this.plotter.mandlebrot.render(xp,  xp + 10, 0, points);

        for(let i =0; i < pixels.length; i++) {

          let pixel = pixels[i];
          this.plotter.executeCommand('DOT', {
            "x": pixel.x, 
            "y": pixel.y,
            "radius": 1.0,
            "color":pixel.color 
          });

        }

        // for next frame 
        xp = xp + 10; 
        
        if(xp >= points) {
          this.pause();
          console.log("xp %s, yp %s", xp, yp);
        }

      }
      
      
      // set plotter properties      
      var range = {
        "x": {"min": -0.8, "max": 0.6},
        "y":  {"min": 0.4, "max": 0.6}
      }

      var plotter = new Plotter({"animation" : false}); 
      plotter.setDebug(false);

      plotter.setXRange(range.x.min, range.x.max);
      plotter.setYRange(range.y.min, range.y.max);
      plotter.setBatchSize(500);
      plotter.setPixels(500, 500);


      var mandlebrot = new Mandlebrot();
      mandlebrot.setGridPoints(points);
      mandlebrot.setColorIndex([10, 50, 100, 200, 300]);
      mandlebrot.setRange(range);

      // bind variables
      plotter.mandlebrot = mandlebrot;
      
      // play animation 
      plotter.bind_animation_handler(process_grid);
      plotter.play();

      

    </script>
  </body>
</html>
