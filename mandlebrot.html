
<!doctype html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title> mandlebrot demo </title>
      <style>
        
        #art {
          width:600px; 
          height:600px;
        }

        #canvas1 {
          width:610px; 
          height:610px;
        }

      </style>

  </head>

  <body>
    

    <div id="art">
      <canvas id="canvas1"> </canvas>
    </div>

    <script type="module">

      // Mandlebrot set rendering 
      // setColorIndex([40, 60, 90, 110, 150, 200, 300]) choice #1
      
      import { Complex, MutableComplex } from '/js/complex.js';
      import { Plotter } from '/js/plotter.js';
      import { ComplexGrid, Julia } from '/js/mandlebrot.js';

      
      const pixels = 500;      
      

      function update_tile_handler(frameCount) {

        // frame update 
        // will draw a vertical line for current x 
        // and advance x to x +1 
        let points = this.plotter.grid.getVerticalPoints();

        // add tiles
        for(let i =0; i < points.length; i++) {
            this.plotter.add(['TDOT', {
              "x": points[i].x,
              "y": points[i].y,
              "color": points[i].color
            }]);
        }
        

        try {
          this.plotter.executeAll();
        } catch(error) {
          console.log("execution error: %d", error.code);
        }

        // check stop condition
        if(this.plotter.grid.stop()) {
          console.log("stop rendering...");
          this.pause();
        }
        
      }

      

        // 
        // 1. fullscreen will override width & height 
        // we must set it to false to set custom 
        // width and height
        // 
        // 2. for pixel art, 
        //  use smoothing: false 
        //  overdraw:true 
        //   
      
     
      var plotter = new Plotter({
       
          "fullscreen": false,
          "overdraw": true,
          "container": document.getElementById("art"),
          "domElement": document.getElementById("canvas1"),
          
          "tiles": {
            "size": 1,
            "total": pixels
          },

          "width": pixels, 
          "height": pixels

      });


      plotter.debug = false;
      plotter.setXRange(-1.5, 1.5);
      plotter.setYRange(-1.5, 1.5);
      plotter.setResolution(pixels, pixels);

      // bind animation event 
      // default animation handler 
      plotter.bind_animation_handler(update_tile_handler);


      var grid = new ComplexGrid({
        "pixels": pixels
      });

      grid.colorIndex = [40, 60, 90, 110, 150, 200, 300];
      grid.transformer = new Julia({
        "fixedParameter": Julia.Parameters.FLOATERS
      });
      
      // bind references 
      grid.plotter = plotter; 
      plotter.grid = grid;

      // play 
      plotter.play();

    </script>



  </body>
</html>
