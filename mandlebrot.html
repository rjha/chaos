
<!doctype html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title> mandlebrot demo </title>
      <style>
        
        #art {
          width:500px; 
          height:500px;
        }

        #canvas1 {
          width:500px; 
          height:500px;
        }

      </style>

  </head>

  <body>
    

    <div id="art">
      <canvas id="canvas1"> </canvas>
    </div>

    <script type="module">

      // Mandlebrot set rendering 
      // setColorIndex([40, 60, 90, 110, 150, 200, 300]) choice #1
      
      import { Complex, MutableComplex } from '/js/complex.js';
      import { Plotter } from '/js/plotter.js';
      import { Mandlebrot } from '/js/mandlebrot.js';

      
      const pixels = 600;      
      var plotter;
      var mandlebrot;
      var xp = 0;

      function update_tile_handler(frameCount) {

        // add the tiles for xp value  
        // execute the tiles command
        this.plotter.mandlebrot.render(xp);
        this.plotter.executeAll();

        // set for next frame 
        xp = xp + 1;

        // stop 
        if(xp > pixels) {
          console.log("stop rendering...");
          this.pause();
        }
        
      }


       // point transformer 
      function transformer(z0) {

        let z = new MutableComplex(z0.x, z0.y);
        let n = 0;

        while(n < 1000) {
          
          z.power(2);
          z.add(mandlebrot.cz);
          
          if(Complex.isBiggerFloat(Complex.magnitude(z), 2.0)) {
            break;
          }

          n = n + 1;

        }

        return {
          "n": n, 
          "magnitude": Complex.magnitude(z)
        }

      }

        // 
        // 1. fullscreen will override width & height 
        // we must set it to false to set custom 
        // width and height
        // 
        // 2. for pixel art, 
        //  use smoothing: false 
        //  overdraw:true 
        //   
      
     
      plotter = new Plotter({
       
          "fullscreen": false,
          "overdraw": true,
          "container": document.getElementById("art"),
          "domElement": document.getElementById("canvas1"),
          
          "tiles": {
            "size": 1,
            "total": pixels
          },
          "width": pixels, 
          "height": pixels
      });

      plotter.debug = false;
      plotter.setXRange(-1.5, 1.5);
      plotter.setYRange(-1.5, 1.5);
      plotter.setResolution(pixels, pixels);

      // bind animation event 
      // default animation handler 
      plotter.bind_animation_handler(update_tile_handler);

      // console.log(plotter.resolution);
      
      var mandlebrot = new Mandlebrot();
      mandlebrot.setColorIndex([40, 60, 90, 110, 150, 200, 300]);
      mandlebrot.setTransformer(transformer);
      mandlebrot.cz = new Complex(-0.1, 0.65);

      // bind references 
      mandlebrot.plotter = plotter; 
      plotter.mandlebrot = mandlebrot;

      // play 
      plotter.play();

    </script>



  </body>
</html>
